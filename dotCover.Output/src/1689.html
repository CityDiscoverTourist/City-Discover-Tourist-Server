<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\C#\CityDiscoverTourist\CityDiscoverTourist.Business\IServices\Services\QuestService.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using AutoMapper;
using CityDiscoverTourist.Business.Data.RequestModel;
using CityDiscoverTourist.Business.Data.ResponseModel;
using CityDiscoverTourist.Business.Helper;
using CityDiscoverTourist.Business.Helper.Params;
using CityDiscoverTourist.Data.IRepositories;
using CityDiscoverTourist.Data.Models;

namespace CityDiscoverTourist.Business.IServices.Services;

public class QuestService: IQuestService
{
    private readonly IQuestRepository _questRepository;
    private readonly ISortHelper&lt;Quest&gt; _sortHelper;
    private readonly IDataShaper&lt;Quest&gt; _dataShaper;
    private readonly IMapper _mapper;

    public QuestService(IQuestRepository questRepository, ISortHelper&lt;Quest&gt; sortHelper, IDataShaper&lt;Quest&gt; dataShaper, IMapper mapper)
    {
        _questRepository = questRepository;
        _sortHelper = sortHelper;
        _dataShaper = dataShaper;
        _mapper = mapper;
    }


    public PageList&lt;Entity&gt; GetAll(QuestParams param)
    {
        var listAll = _questRepository.GetAll();

        Search(ref listAll, param);

        var sortedQuests = _sortHelper.ApplySort(listAll, param.OrderBy);
        var shapedData = _dataShaper.ShapeData(sortedQuests, param.Fields);

        return PageList&lt;Entity&gt;.ToPageList(shapedData, param.PageNume, param.PageSize);
    }

    public async Task&lt;QuestResponseModel&gt; Get(Guid id, string? fields)
    {
        var entity = await _questRepository.Get(id);

        //var shaped = _dataShaper.ShapeData(entity, fields);

        return _mapper.Map&lt;QuestResponseModel&gt;(entity);
    }

    public async Task&lt;QuestResponseModel&gt; CreateAsync(QuestRequestModel request)
    {
        var entity = _mapper.Map&lt;Quest&gt;(request);
        entity = await _questRepository.Add(entity);
        return _mapper.Map&lt;QuestResponseModel&gt;(entity);
    }

    public async Task&lt;QuestResponseModel&gt; UpdateAsync(QuestRequestModel request)
    {
        var entity = _mapper.Map&lt;Quest&gt;(request);
        entity = await _questRepository.Update(entity);
        return _mapper.Map&lt;QuestResponseModel&gt;(entity);
    }

    public async Task&lt;QuestResponseModel&gt; DeleteAsync(Guid questId)
    {
        var entity = await _questRepository.Delete(questId);
        return _mapper.Map&lt;QuestResponseModel&gt;(entity);
    }


    private static void Search(ref IQueryable&lt;Quest&gt; entities, QuestParams param)
    {
        if (!entities.Any() || string.IsNullOrWhiteSpace(param.Name) &amp;&amp; string.IsNullOrWhiteSpace(param.Status)) return;

        entities = entities.Where(r =&gt; r.Name!.Contains(param.Name!) || r.Status!.Contains(param.Status!));
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[18,5,18,136,0],[19,5,19,6,0],[20,9,20,44,0],[21,9,21,34,0],[22,9,22,34,0],[23,9,23,26,0],[24,5,24,6,0],[28,5,28,6,0],[29,9,29,49,0],[31,9,31,36,0],[33,9,33,74,0],[34,9,34,76,0],[36,9,36,88,0],[37,5,37,6,0],[40,5,40,6,0],[41,9,41,53,0],[45,9,45,56,0],[46,5,46,6,0],[49,5,49,6,0],[50,9,50,50,0],[51,9,51,53,0],[52,9,52,56,0],[53,5,53,6,0],[56,5,56,6,0],[57,9,57,50,0],[58,9,58,56,0],[59,9,59,56,0],[60,5,60,6,0],[63,5,63,6,0],[64,9,64,61,0],[65,9,65,56,0],[66,5,66,6,0],[70,5,70,6,0],[71,9,71,113,0],[71,114,71,121,0],[73,9,73,108,0],[74,5,74,6,0]]);
    </script>
  </body>
</html>